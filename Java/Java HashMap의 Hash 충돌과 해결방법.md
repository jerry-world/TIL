# Java HashMap의 Hash 충돌과 해결방법

HashMap은 Map 인터페이스의 실체 클래스로써, Key와 Value를 갖는 엔티티를 저장할 수 있는 구조의 자료구조이다. 값은 중복하여 저장할 수 있지만, 키는 중복될 수 없다는 특징을 가지고 있다.

HashMap에서의 이 `Hash`는 말그대로 Hash 알고리즘을 통해, 데이터를 저장하고 보다 빠르게 데이터를 색인할 수 있도록 함에 있다. 실제로 HashMap은 데이터를 저장할 때, Hashcode를 사용하여 데이터를 bucket이라는 공간에 저장하게 된다.

그러면 Hash 충돌은 무엇을 의미할까?

쉬운 예시를 들어보자. 1개의 반에 총 30명이 수강할 수 있는 오프라인 클래스가 개설되었다. 정원 30명이 모두 찼고, 강의를 진행하는 중 이 강의가 인기가 폭발을 해서 5명이 추가로 더 들어왔다. 이 강의는 자리에 꼭 앉아야 들을 수 있다. 그러면 나머지 5명은 어찌됐든 30명의 자리 중 특정한 곳에 같이 앉아야한다.

이런 상황을 해시 충돌이라고 말한다.

자바에서 이 Hashcode는 Int타입인데, Int는 4바이트(2^32)로 되어있다. 반면 HashMap의 키로 String이나 Object 등 의 대상들은 4바이트보다 많은 데이터가 들어올 수도 있다. 물론 그렇지 않을 수도 있다. 어찌됐든 4바이트 내에서 해싱을 하는 과정에 동일한 해시값을 갖는 대상들도 분명히 존재할 수 있다는 의미이다.

때문에 이 해시 충돌이 발생하면, 서로 다른 키 값이지만 같은 버킷에 데이터가 저장될 수도 있다. 때문에 HashMap은 버킷을 LinkedList로 구현하여, 해시 충돌이 발생하여 저장되는 값을 저장하고, 각각의 링크된 원소들은 서로의 주소값을 갖고 있게된다. Java 8 이후부터는 이 linkedList도 사용하지만, 충돌 대상이 8개가 넘으면 Red-black 트리 구조로 바뀌게된다. 데이터가 많을 때 성능이 더 좋은 자료구조를 선택적으로 선정할 수 있도록 한 것이다.

그리고 다시 충돌 대상이 6개가 되면, LinkedList로 바뀌게 된다.