# Atomic íƒ€ìž…

Javaì—ì„œ ë³€ìˆ˜ì˜ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ, `java.util.concurrent.atomic` íŒ¨í‚¤ì§€ê°€ ì¡´ìž¬í•œë‹¤.

![Untitled](Atomic%20íƒ€ìž…/Untitled.png)

ì´ Atomic ë³€ìˆ˜ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë ¤ê³ í•œë‹¤.

í”„ë¡œê·¸ëž˜ë°ì„ í•˜ë‹¤ë³´ë©´ **ë©€í‹° ìŠ¤ë ˆë“œ**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë¹ˆë²ˆí•˜ë‹¤. ë©€í‹° ìŠ¤ë ˆë“œ í”„ë¡œê·¸ëž˜ë°ì—ì„œ ê°€ìž¥ ì¤‘ìš”í•˜ê²Œ ê³ ë ¤í•´ì•¼í•˜ëŠ” ë¶€ë¶„ì´ `ë™ì‹œì„± ë¬¸ì œ` ì´ë‹¤. 

ì´ Atomic ë³€ìˆ˜ëŠ” ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ìµœì‹  ë°ì´í„° ìž„ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ ì œê³µë˜ëŠ” ë³€ìˆ˜ì´ë‹¤.

Atomicì˜ ëœ»ì„ í’€ì´í•˜ë©´ ì›ìžë¼ëŠ” ì˜ë¯¸ë¥¼ ê°€ì§€ê³  ìžˆëŠ”ë°, ì´ëŠ” `ë” ì´ìƒ ìª¼ê°¤ ìˆ˜ ì—†ëŠ” ê°€ìž¥ ë‹¨ìœ„` ë¡œ í•´ì„í•  ìˆ˜ ìžˆë‹¤.

> ðŸ’¡ In programming, an atomic action is one that effectively happens all at once.
> An atomic action cannot stop in the middle: it either happens completely, or it doesn't happen at all.


ì¸í„°ë„· ì‡¼í•‘ëª°ì—ì„œ ë¬¼ê±´ì„ ì‚´ ë•Œì˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ê²°ì œ ì •ë³´ì™€ ê²°ì œì— ë”°ë¥¸ ìƒí’ˆ ìˆ˜ëŸ‰ ê°ì†Œ ì•¡ì…˜ì´ í•¨ê»˜ ë§žë¬¼ë ¤ ì§„í–‰ë˜ì–´ì•¼ í•œë‹¤. ë§Œì•½ ê²°ì œëŠ” ë˜ì—ˆëŠ”ë° ìˆ˜ëŸ‰ì´ ê°ì†Œë˜ì§€ ì•Šì•˜ë‹¤ë©´, ë‹¤ë¥¸ ì‚¬ìš©ìžëŠ” ìˆ˜ëŸ‰ì´ ì¡´ìž¬í•˜ëŠ” ì¤„ ì•Œê³ , ìƒí’ˆì„ êµ¬ë§¤í•˜ê²Œ ë˜ì–´, ë¬´ê²°ì„±ì˜ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

ë‹¨ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œê°€ ìˆœì°¨ì ìœ¼ë¡œ ì—…ë¬´ë¥¼ ìˆ˜í–‰í•œë‹¤ë©´, ì´ëŸ° ë¬¸ì œëŠ” ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤. ê·¸ëŸ°ë° ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ìƒí’ˆì„ ê°ì†Œì‹œí‚¤ëŠ” ë“±ì˜ ìž‘ì—…ì„ ìˆ˜í–‰í•˜ë©´ ìœ„ì™€ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.

ë•Œë¬¸ì— ìœ„ì˜ ì˜ˆì‹œì²˜ëŸ¼ ì•¡ì…˜ì´ ì—¬ëŸ¬ê°œê°€ ë¶„ë¦¬(ë¹„ ì›ìžì„±)ë˜ì–´ í•˜ë‚˜ëŠ” ì‹¤í–‰ë˜ê³  í•˜ë‚˜ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ ì—†ê²Œ í•˜ë ¤ë©´ Atomic ì´ í•„ìš”í•˜ë‹¤.

Java ì—ì„œëŠ” ë™ì‹œì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ `volatile`, `synchronized`, `atomic` ì„ ì§€ì›í•œë‹¤.

ê·¸ì¤‘ ì´ atomic íƒ€ìž…ì€ ë‹¨ì¼ ë³€ìˆ˜ì— ëŒ€í•´ ì›ìžì„± ìž‘ì—…ì„ ì§€ì›í•œë‹¤. ì°¸ì¡° íƒ€ìž… ë˜ëŠ” ì›ì‹œíƒ€ìž…ì— ëŒ€í•œ Wrapper Class í˜•íƒœì´ë©°, ì‚¬ìš© ì‹œ ë‚´ë¶€ì ìœ¼ë¡œ `CAS(Compare-And-Swap)` ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ lock ì—†ì´ ë™ê¸°í™”ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìžˆë‹¤.

# Atomic íƒ€ìž…ì˜ ë³€ìˆ˜ ì‚¬ìš©í•´ë³´ê¸°

Atomic íƒ€ìž…ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì•Œê³  ìžˆëŠ” ì°¸ì¡°íƒ€ìž… ì•žì— Atomicë§Œ ë¶™í˜€ì£¼ë©´ëœë‹¤.

![Untitled](Atomic%20íƒ€ìž…/Untitled%201.png)

ê·¸ëŸ¬ë©´ ë™ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ì˜ˆì‹œì™€ í•¨ê»˜ Atomic íƒ€ìž…ì˜ ë™ìž‘ ì›ë¦¬ë¥¼ ì´í•´í•´ë³´ìž.

```java
private static int num = 0;
    public static void main(String[] args) throws InterruptedException {
        AtomicInteger atomicInteger = new AtomicInteger(0);

        Thread thread1 = new Thread(() -> {
            for (int i = 0; i < 100000; i++) {
                num++;
                atomicInteger.incrementAndGet();
            }
        });

        Thread thread2 = new Thread(() -> {
            for (int i = 0; i < 100000; i++) {
                num++;
                atomicInteger.incrementAndGet();
            }
        });

        thread1.start();
        thread2.start();

        Thread.sleep(5000);

        System.out.println("atomicInteger = " + atomicInteger.get());
        System.out.println("num = " + num);
    }
```

ìœ„ì˜ ì˜ˆì‹œë¥¼ ì‚´íŽ´ë³´ìž. Atomicì€ ë™ì‹œì„±ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤ê³  í–ˆë‹¤. ê°ê°ì˜ thread1ê³¼ thread2ëŠ” forë¬¸ì„ ëŒë©´ì„œ int íƒ€ìž… numì„ ì¦ê°€ì‹œí‚¤ê³ , AtomicInteger íƒ€ìž… atomicIntegerë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.

![Untitled](Atomic%20íƒ€ìž…/Untitled%202.png)

ìˆ˜í–‰ê²°ê³¼ ì›ì‹œíƒ€ìž… numì€ ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ 161,012 ê°’ì´ ì¶œë ¥í–ˆë‹¤. ì´ë¬¸ì œëŠ” ê°€ë ¹ thread1ì™€ thread2ê°€ ê°’ì´ ë™ì‹œì— ì¦ê°€ë˜ë©´ì„œ ë°œìƒí•  ìˆ˜ ìžˆê² ë‹¤.

ì˜ˆë¥¼ ë“¤ìžë©´, thread1ë²ˆì´ forë¬¸ì„ ëŒì•˜ì„ ë•Œì˜ num ê°’ì´ 15333ì´ê³ , ë•Œë§ˆì¹¨ thread1ì´ ê°’ì„ ì¦ê°€ì‹œí‚¤ê¸°ì „ì— thread2ë²ˆì´ forë¬¸ì„ ëŒì•˜ì„ ë•Œì˜ num ê°’ì´ 15333ì´ì–´ì„œ ë‘˜ë‹¤ ì¦ê°€ì‹œì¼œë„ ë™ì¼í•˜ê²Œ 15334ë¡œ ë§ˆì¹œ ê²ƒì´ë‹¤. ë‹¤ë¥¸ ê²½ìš°ë„ ìžˆê² ì§€ë§Œ ì—¬í•˜íŠ¼, ì´ëŠ” ë™ê¸°í™”ê°€ ì§€ì¼œì§€ì§€ ì•Šì•„ ë°œìƒí•œ ë¬¸ì œì´ë‹¤.

ì‚¬ìš©í•˜ê³  ìžˆëŠ” ëŒ€ìƒì˜ num ê°’ì´ í•­ìƒ ìµœì‹ ì˜ ê²ƒì„ ìœ ì§€í•˜ê³  ìžˆë‹¤ë©´ ì´ëŸ° ë™ì‹œì„± ë¬¸ì œëŠ” ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.

ê·¸ëž˜ì„œ ì‚¬ìš©í•œ ê²ƒì´ Atomic íƒ€ìž…ì˜ ë³€ìˆ˜ì¸ AtomicIntegerì´ë‹¤. ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë°”ì™€ ê°™ì´ Atomicíƒ€ìž…ì€ CAS(Compare And Swap) ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬, ë°ì´í„°ë¥¼ ë™ê¸°í™”í•´ì¤€ë‹¤. ì¦‰, í•­ìƒ ìµœì‹  ë°ì´í„°ë¥¼ ìœ ì§€í•  ìˆ˜ ìžˆë„ë¡ ë„ì™€ì¤€ë‹¤.

ê·¸ëŸ¬ë©´ AtomicIntegerì—ì„œ ì–´ë–»ê²Œ CAS ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê³  ìžˆëŠ”ì§€ ì•Œì•„ë³´ìž.

ìœ„ì˜ ì˜ˆì œì—ì„œ AtomicIntegerì˜ ê°’ì„ ì¦ê°€ì‹œí‚¤ê¸° ìœ„í•´, getAndIncrementë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤. getAndIncrement ë©”ì„œë“œëŠ” getAndAddInt ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ”ë°, getAndAddInt ë©”ì„œë“œë¥¼ ë³´ë©´ ì›ìžì ìœ¼ë¡œ ì „ë‹¬ë°›ì€ ì£¼ì–´ì§„ ê°’ì„ ì¦ê°€ì‹œí‚¨ë‹¤ê³  ë˜ì–´ìžˆë‹¤.

ì—¬ê¸°ì„œ getInVolatileì€ CPU ìºì‹œê°€ ì•„ë‹Œ ë©”ì¸ ë©”ëª¨ë¦¬ì˜ ê°’ì„ ê°€ì§€ê³  ì˜¤ëŠ” ê²ƒì´ë‹¤. í•´ë‹¹ ë©”ì„œë“œì˜ ë‚´ìš©ì„ ì‚´íŽ´ë³´ë©´ ë©”ì¸ ë©”ëª¨ë¦¬ì˜ ê°’ì„ ê°€ì ¸ì˜¤ê³  ê°€ì ¸ì˜¨ ê°’ì´ ìž…ë ¥ë°›ì€ ê°’ê³¼ ë™ì¼í•œì§€ ë¹„êµí›„, ì¼ì¹˜ í• ë•Œê¹Œì§€ do-whileë¬¸ì„ ë°˜ë³µí•˜ì—¬ ì¼ì¹˜í•œ ê²½ìš°ì— ê°’ì„ ì¦ê°€í•œ ë’¤ ë¦¬í„´í•˜ê²Œ ë˜ì–´ìžˆë‹¤.

ì´ë§ì¸ì¦‰ìŠ¨, ì „ë‹¬ë°›ì€ ê°’ì´ ìµœì‹ ì´ë©´ ê°’ì„ ì¦ê°€ì‹œí‚¤ê² ë‹¤ëŠ” ëœ»ìœ¼ë¡œ ëŒë ¤ í•´ì„í•  ìˆ˜ ìžˆë‹¤.

![Untitled](Atomic%20íƒ€ìž…/Untitled%203.png)

![Untitled](Atomic%20íƒ€ìž…/Untitled%204.png)

![Untitled](Atomic%20íƒ€ìž…/Untitled%205.png)

ìœ„ì˜ ê·¸ë¦¼ì€ ì˜ˆì‹œë¥¼ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë ¤ë³¸ ë‚´ìš©ì´ë‹¤.(ë‚´ê°€ ì´í•´í•œ ëŒ€ë¡œ..)

Thread-1ê³¼ Thread-2ê°€ AtomicIntegeríƒ€ìž…ì˜ ê°ì²´ì— ëŒ€í•´ incrementAndGetì„ forë¬¸ì„ í†µí•´ ê° 10ë§Œë²ˆì”© í˜¸ì¶œí•˜ê³  ìžˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œ ì¦‰, ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë™ì¼í•œ AtomicInteger ëŒ€ìƒì˜ ê°’ì„ ë§¤ë²ˆ ì¦ê°€ ìš”ì²­ì„ í•˜ê³ ìžˆë‹¤. ì´ëŸ° ë¹„ ì›ìžì„± ìƒí™©ì—ì„œ ì›ìžì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´, incrementAndGet ë©”ì„œë“œëŠ” getAndAddInt ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ì´ getAndAddInt ë©”ì„œë“œëŠ” ë©”ì¸ ë©”ëª¨ë¦¬ì— ìž‘ì„±ëœ ê°’ì´ ìš”ì²­ëœ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ê°’ì„ ì¦ê°€ì‹œí‚¨ë‹¤.

ë‹¤ë¥¸ íƒ€ìž…ì˜ Atomic ë³€ìˆ˜ë“¤ë„ ìœ„ì™€ ë¹„ìŠ·í•˜ë‹¤. ê°€ë ¹ AtomicBooleanì˜ ê²½ìš°ì—ëŠ” ë“¤ì–´ì˜¨ ê°’ì´ trueì¼ ê²½ìš° í˜„ìž¬ ë©”ì¸ ë©”ëª¨ë¦¬ìƒì˜ ê°’ì´ trueê°€ ë§žëŠ”ì§€ í™•ì¸í•˜ê³  ê°’ì„ ë³€ê²½í•´ì¤€ë‹¤.

# CAS ì•Œê³ ë¦¬ì¦˜

CAS ì•Œê³ ë¦¬ì¦˜ì€ ë§ê·¸ëŒ€ë¡œ ë¹„êµí•˜ê³  êµì²´í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.

CAS ì•Œê³ ë¦¬ì¦˜ì„ ê²€ìƒ‰í•´ë³´ë©´ ì•„ëž˜ì˜ ê·¸ë¦¼ì´ ë§Žì´ ë‚˜ì˜¨ë‹¤.

![Untitled](Atomic%20íƒ€ìž…/Untitled%206.png)

ì•Œê³ ìžˆëŠ” í˜„ìž¬ ê°’ê³¼ ë¹„êµëŒ€ìƒ(ì‹¤ì œê°’) ê°’ ê·¸ë¦¬ê³  ë³€ê²½ ê°’ 3ê°€ì§€ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, ì•Œê³ ìžˆëŠ” í˜„ìž¬ ê°’ê³¼ ë¹„êµëŒ€ìƒ ê°’ì´ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì— ë³€ê²½í•  ê°’ìœ¼ë¡œ ê°’ì„ swapí•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤. 

ì´ë ‡ê²Œ í•œë²ˆ í™•ì¸í•˜ê³  ë³€ê²½í•˜ëŠ” ë°©ì‹ì˜ íŒ¨í„´ì„ â€˜ì²´í¬-ì•¡íŠ¸â€™ íŒ¨í„´ì´ë¼ê³  ë¶€ë¥´ê¸°ë¡œ ì•½ì†í–ˆë‹¤.

ì—¬ê¸°ì„œ í˜„ìž¬ê°’ê³¼ ì‹¤ì œê°’ì´ ì˜ë¯¸í•˜ëŠ” ë°”ê°€ ë©”ì¸ë©”ëª¨ë¦¬ ìƒì˜ ê°’ê³¼ CPU ìºì‹œ ìƒì˜ ê°’ì´ë‹¤. CPU ìºì‹œì— ê°’ì´ ì˜¬ë ¤ì§„ ì°°ë‚˜ì— ë©”ì¸ ë©”ëª¨ë¦¬ ìƒì˜ ê°’ì´ ë°”ë€Œë©´ ë‘ ê°’ì„ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ëž˜ì„œ ê·¸ëŸ´ ê²½ìš° ë‹¤ì‹œ ìž¬ì‹œë„í•˜ì—¬ í•­ìƒ ìµœì‹ ì˜ ê°’ì„ ìœ ì§€í•œ ìƒíƒœë¡œ ê°’ì„ ì¦ê°€í•  ìˆ˜ ìžˆê²Œ í•´ì¤€ë‹¤.

ë¨¼ê°€ ë‚´ìš©ë„ ì „ë¬¸ì ì´ì§€ ì•Šê³ , ë‘ì„œì—†ì´ ìž‘ì„±ëœ ê²ƒ ê°™ë‹¤. 

ê²°ê³¼ì ìœ¼ë¡œëŠ” Atomic ë³€ìˆ˜ëŠ” CAS ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ í•­ìƒ ìµœì‹ ì˜ ê²ƒì„ ë³´ìž¥í•˜ë„ë¡(ì›ìžì„± ë³´ìž¥) ë„ì™€ì£¼ê³  ì´ë¥¼ í†µí•´, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— í•´ë‹¹ ë³€ìˆ˜ì— ì ‘ê·¼í•˜ì—¬ ìž‘ì—…í•˜ë”ë¼ë„, í•­ìƒ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ë©´ ìž‘ì—…ë  ìˆ˜ ìžˆë‹¤.
